<!DOCTYPE html>
<html>

<head>
    <title>ULabel</title>

    <!-- ULabel Library -->
    <script src="/ulabel.js"></script>

    <!-- JQuery Library -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <!-- ULabel Usage -->
    <script>
        /* global $ */
        /* global ULabel */

        $(window).on("load", function () {

            function on_submit(annotations) {
                var element = document.createElement('a');
                element.setAttribute(
                    "href", ('data:text/plain;charset=utf-8,' +
                        encodeURIComponent(JSON.stringify(annotations, null, 2)))
                );
                element.setAttribute("download", "annotations.json");
                element.style.display = 'none';
                document.body.appendChild(element);
                element.click();
                document.body.removeChild(element);
            }

            let subtasks = {
                "car_detection": {
                    "display_name": "Car Detection",
                    "classes": [
                        {
                            "name": "Sedan",
                            "color": "blue",
                            "id": 10,
                            "keybind": "1",
                        },
                        {
                            "name": "SUV",
                            "color": "green",
                            "id": 11,
                            "keybind": "2",
                        },
                        {
                            "name": "Truck",
                            "color": "orange",
                            "id": 12,
                            "keybind": "3",
                        },
                    ],
                    "allowed_modes": ["bbox", "polygon", "contour", "polyline", "point", "tbar", "delete_polygon", "delete_bbox"],
                    "resume_from": null,
                    "task_meta": null,
                    "annotation_meta": null
                },
                "frame_review": {
                    "display_name": "Frame Review",
                    "classes": [
                        {
                            "name": "Blurry",
                            "color": "gray",
                            "id": 20
                        },
                        {
                            "name": "Occluded",
                            "color": "red",
                            "id": 21
                        }
                    ],
                    "allowed_modes": ["whole-image"],
                    "resume_from": null,
                    "task_meta": null,
                    "annotation_meta": null
                }
            };

            // Initial ULabel configuration
            let ulabel = new ULabel({
                "container_id": "container",
                "image_data": "https://ulabel.s3.us-east-2.amazonaws.com/cs-demo-0.png",
                "username": "DemoUser",
                "submit_buttons": [{
                    "name": "Submit",
                    "hook": on_submit,
                    "size_factor": 0.7,
                }],
                "subtasks": subtasks,
                "initial_line_size": 2,
                "config_data": {
                    "toggle_brush_mode_keybind": "f",
                    "create_bbox_on_initial_crop": "|",
                }
            });
            // Wait for ULabel instance to finish initialization
            ulabel.init(function () {
                // ULabel is now ready for use
                console.log(ulabel);
            });

        });
    </script>
</head>

<body>
    <div id="container" style="width: 100%; height: 100vh; position: absolute; top: 0; left: 0;"></div>
</body>

</html>