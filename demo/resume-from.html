<!DOCTYPE html>
<html>
    <head>
        <title>ULabel</title>

        <!-- ULabel Library -->
        <script src="/ulabel.js"></script>

        <!-- JQuery Library -->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

        <!-- ULabel Usage -->
        <script>
            /* global $ */
            /* global ULabel */

            $(window).on("load", function() {

                function on_submit(annotations) {
                    var element = document.createElement('a');
                    element.setAttribute(
                        "href", ('data:text/plain;charset=utf-8,' + 
                        encodeURIComponent(JSON.stringify(annotations, null, 2)))
                    );
                    element.setAttribute("download", "annotations.json");
                    element.style.display = 'none';
                    document.body.appendChild(element);
                    element.click();
                    document.body.removeChild(element);
                }

                let resume_from = [
                  {
                    "id": "4a786dc4-0efa-4563-a42b-8eea3dd5b04b", 
                    "spatial_type": "point", 
                    "spatial_payload": [[300, 300]], 
                    "classification_payloads": [
                      {"id": "c72ea9a1-79f9-444c-a01a-7983f0697b4a", "class_id": 12, "confidence": 0.0},
                      {"id": "c72ea9a1-79f9-444c-a01a-7983f0697b4a", "class_id": 11, "confidence": 1.0},
                      {"id": "c72ea9a1-79f9-444c-a01a-7983f0697b4a", "class_id": 10, "confidence": 0.0},
                    ],
                    "line_width": 4
                  },
                  {
                    "id": "4a586dc4-0efa-4563-a42b-8eea3dd5b04b", 
                    "spatial_type": "point", 
                    "spatial_payload": [[400, 300]], 
                    "classification_payloads": [
                      {"id": "c72ea9a1-79f9-444c-a01a-7983f0697b4a", "class_id": 10}
                    ],
                    "line_width": 4
                  },
                  {
                    "id": "4a686dc4-0efa-4563-a42b-8eea3dd5b04b", 
                    "spatial_type": "point", 
                    "spatial_payload": [[300, 400]], 
                    "classification_payloads": [
                      {"id": "c72ea9a1-79f9-444c-a01a-7983f0697b4a", "class_id": 12}
                    ],
                    "line_width": 4
                  },
                  {
                    "id": "4a186dc4-0efa-4563-a42b-8eea3dd5b04b",
                    "spatial_type": "polygon",
                    "spatial_payload": [
                        [
                            [
                                1073.7851163857356,
                                444.8664144020181
                            ],
                            [
                                1228.5830282412717,
                                254.64864135919825
                            ],
                            [
                                1390.4313725490197,
                                314.562091503268
                            ],
                            [
                                1358.6405228758172,
                                593.9869281045751
                            ],
                            [
                                1073.7851163857356,
                                444.8664144020181
                            ]
                        ],
                        [
                            [
                                1189.6470588235295,
                                438.37908496732024
                            ],
                            [
                                1249.8823529411766,
                                346.3529411764706
                            ],
                            [
                                1306.7712418300653,
                                478.5359477124183
                            ],
                            [
                                1189.6470588235295,
                                438.37908496732024
                            ]
                        ]
                    ],
                    "classification_payloads": [
                        {"id": "c72ea9a1-79f9-444c-a01a-7983f0697b4a", "class_id": 11},
                        {"class_id": -1, "confidence": 0.0}
                    ],
                  },
                  {
                    "id": "d0f9b427-123d-46c0-a131-84db3f002b6f",
                    "new": true,
                    "parent_id": null,
                    "created_by": "weeds_model",
                    "created_at": "2024-06-12T20:31:28.942761",
                    "deprecated": false,
                    "deprecated_by": {
                        "human": false
                    },
                    "spatial_type": "polygon",
                    "spatial_payload": [
                        [
                            [
                                464.5,
                                261.5
                            ],
                            [
                                461.5,
                                264.5
                            ],
                            [
                                468.5,
                                268.5
                            ],
                            [
                                463.5,
                                271.5
                            ],
                            [
                                466.5,
                                271.5
                            ],
                            [
                                471.5,
                                264.5
                            ],
                            [
                                464.5,
                                261.5
                            ]
                        ],
                        [
                            [
                                467.5,
                                267.5
                            ],
                            [
                                468.5,
                                266.5
                            ],
                            [
                                469.5,
                                267.5
                            ],
                            [
                                468.5,
                                268.5
                            ],
                            [
                                467.5,
                                267.5
                            ]
                        ]
                    ],
                    "classification_payloads": [
                        {
                            "class_id": 10,
                            "confidence": 1
                        },
                        {
                            "class_id": 11,
                            "confidence": 0
                        }
                    ],
                    "line_size": 3,
                    "text_payload": "",
                    "annotation_meta": null
                    }, 
                ];

                let subtasks = {
                    "car_detection": {
                        "display_name": "Car Detection",
                        "classes": [
                            {
                                "name": "Sedan",
                                "color": "blue",
                                "id": 10,
                                "keybind": "1",
                            },
                            {
                                "name": "SUV",
                                "color": "green",
                                "id": 11,
                                "keybind": "2",
                            },
                            {
                                "name": "Truck",
                                "color": "orange",
                                "id": 12,
                                "keybind": "3",
                            },
                        ],
                        "allowed_modes": ["bbox", "polygon", "contour", "polyline", "delete_bbox"],
                        "resume_from": resume_from,
                        "task_meta": null,
                        "annotation_meta": null
                    },
                    "frame_review": {
                        "display_name": "Frame Review",
                        "classes": [
                            {
                                "name": "Blurry",
                                "color": "gray",
                                "id": 20
                            },
                            {
                                "name": "Occluded",
                                "color": "red",
                                "id": 21
                            }
                        ],
                        "allowed_modes": ["whole-image"],
                        "resume_from": null,
                        "task_meta": null,
                        "annotation_meta": null
                    }
                };

                // Initial ULabel configuration
                let ulabel = new ULabel({
                    "container_id": "container",
                    "image_data": "https://ulabel.s3.us-east-2.amazonaws.com/cs-demo-0.png",
                    "username": "DemoUser",
                    "submit_buttons": on_submit,
                    "subtasks": subtasks
                });
                // Wait for ULabel instance to finish initialization
                ulabel.init(function() {
                    // ULabel is now ready for use
                });

            });
        </script>
    </head>
    <body>
        <div id="container" style="width: 100%; height: 100vh; position: absolute; top: 0; left: 0;"></div>
    </body>
</html>